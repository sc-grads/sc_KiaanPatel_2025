name: SQL Server Database Setup Template

on:
  workflow_dispatch:
    inputs:
      skip-production:
        description: 'Skip production deployment?'
        required: false
        default: 'false'
        type: boolean

# Add concurrency to allow parallel runs
concurrency:
  group: ${{ github.workflow }}-${{ github.event.inputs.environment || 'default' }}
  cancel-in-progress: false  # Allows multiple runs without canceling previous ones

jobs:
  development:
    uses: ./.github/workflows/SetUpTemplate.yml
    with:
      environment: 'development'
      sql-script-path: 'DatabaseAdministration/SQLStatements/ProductionAndDeploymentProject.sql'
    secrets:
      SQL_SERVER: ${{ secrets.PINGGY_URL }}
      SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}

  production:
    needs: development
    if: ${{ !inputs.skip-production }}
    uses: ./.github/workflows/SetUpTemplate.yml
    with:
      environment: 'production'
      sql-script-path: 'DatabaseAdministration/SQLStatements/ProductionAndDeploymentProject.sql'
      sql-user: "Friend_user"  # Add this if your friend's username differs from Auto_user
    secrets:
      SQL_SERVER: ${{ secrets.FRIEND_SERVER_URL }}
      SQL_PASSWORD: ${{ secrets.FRIEND_SQL_PASSWORD }}
