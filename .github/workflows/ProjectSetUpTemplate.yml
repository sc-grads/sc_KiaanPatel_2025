name: Template SQL Server Database Setup 

on:
  workflow_dispatch:
    inputs:
      skip-production:
        description: 'Skip production deployment?'
        required: false
        default: 'false'
        type: boolean

env:
  DEV_SQL_URL: ${{ secrets.PINGGY_URL }}
  DEV_SQL_PASSWORD: ${{ secrets.SQL_PASSWORD }}
  PROD_SQL_URL: ${{ secrets.FRIEND_SERVER_URL }}
  PROD_SQL_PASSWORD: ${{ secrets.FRIEND_SQL_PASSWORD }}

jobs:
  development:
    uses: ./.github/workflows/SetUpTemplate.yml
    secrets: inherit
    with:
      environment-type: 'development'
      sql-server-url: ${{ env.DEV_SQL_URL }}
      sql-password: ${{ env.DEV_SQL_PASSWORD }}
      sql-script-path: 'DatabaseAdministration/SQLStatements/ProductionAndDeploymentProject.sql'

  production:
    needs: development
    if: ${{ !inputs.skip-production }}
    uses: ./.github/workflows/SetUpTemplate.yml
    secrets: inherit
    environment: Need-Siphenathi-Approval
    with:
      environment-type: 'production'
      sql-server-url: ${{ env.PROD_SQL_URL }}
      sql-password: ${{ env.PROD_SQL_PASSWORD }}
      sql-script-path: 'DatabaseAdministration/SQLStatements/ProductionAndDeploymentProject.sql'
